<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOAi Workflow Agents - ROI Calculator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #000; color: #fff; }
        .dashboard { display: grid; grid-template-columns: 400px 1fr; min-height: 100vh; }
        .sidebar { background: #0a0a0a; padding: 30px; overflow-y: auto; position: sticky; top: 0; height: 100vh; border-right: 2px solid #1a1a1a; }
        .main-content { padding: 40px; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 25px; padding: 30px 20px; background: linear-gradient(135deg, #4B9CD3 0%, #13294B 100%); border-radius: 12px; }
        .header h1 { font-size: 1.8em; font-weight: 300; }
        .header p { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }
        .section { background: #1a1a1a; border-radius: 20px; padding: 40px; margin-bottom: 40px; }
        .sidebar-title { font-size: 1.15em; font-weight: 600; margin-bottom: 15px; color: #4B9CD3; text-transform: uppercase; letter-spacing: 0.5px; }
        .input-group { margin-bottom: 18px; }
        .input-group label { display: block; font-size: 0.85em; color: #d4d4d4; margin-bottom: 8px; font-weight: 500; }
        .input-group input { background: #1a1a1a; border: 2px solid #2a2a2a; border-radius: 8px; padding: 12px; font-size: 0.95em; color: #fff; width: 100%; font-family: inherit; }
        .input-group input:focus { outline: none; border-color: #4B9CD3; box-shadow: 0 0 0 3px rgba(75,156,211,0.1); }
        .input-group input.warning { border-color: #ffa94d; }
        .input-group input.error { border-color: #ff6b6b; }
        .warning-msg { color: #ffa94d; font-size: 0.8em; margin-top: 5px; padding: 8px 10px; background: rgba(255,169,77,0.1); border-radius: 6px; border-left: 3px solid #ffa94d; }
        .error-msg { color: #ff6b6b; font-size: 0.8em; margin-top: 5px; padding: 8px 10px; background: rgba(255,107,107,0.1); border-radius: 6px; border-left: 3px solid #ff6b6b; }
        .timeframe { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .btn { background: #2a2a2a; border: 2px solid #333; color: #aaa; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.85em; text-align: center; font-family: inherit; transition: all 0.3s; }
        .btn:hover { background: #333; border-color: #4B9CD3; transform: translateY(-1px); }
        .btn.active { background: #4B9CD3; color: #fff; }
        .btn.primary { background: #4B9CD3; color: #fff; font-weight: 600; border: 2px solid #4B9CD3; }
        .btn.primary:hover { background: #5AADDE; }
        .btn-small { padding: 10px 20px; font-size: 0.9em; }
        .divider { height: 2px; background: #1a1a1a; margin: 20px 0; }
        .slider { width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(to right, #2a2a2a 0%, #4B9CD3 100%); outline: none; -webkit-appearance: none; margin: 15px 0; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #fff; cursor: pointer; border: 3px solid #4B9CD3; }
        .slider::-moz-range-thumb { width: 24px; height: 24px; border-radius: 50%; background: #fff; cursor: pointer; border: 3px solid #4B9CD3; }
        .slider-value { text-align: center; font-size: 1.8em; font-weight: 300; color: #4B9CD3; margin: 10px 0; }
        .slider-labels { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.75em; color: #666; }
        .benchmark-btns { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 15px; }
        .benchmark-info { text-align: center; margin-top: 12px; padding: 10px; background: rgba(75,156,211,0.1); border-radius: 6px; font-size: 0.8em; line-height: 1.4; }
        .badge { background: #13294B; border-left: 4px solid #4B9CD3; padding: 18px; border-radius: 8px; margin-bottom: 30px; color: #fff; font-size: 0.95em; font-weight: 500; }
        .hero { background: linear-gradient(135deg, #4B9CD3 0%, #13294B 100%); border-radius: 20px; padding: 60px 40px; text-align: center; margin-bottom: 40px; position: relative; }
        .big { font-size: 6.5em; font-weight: 100; margin: 20px 0; letter-spacing: -3px; }
        .grid3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .card { background: #1a1a1a; border-radius: 15px; padding: 30px; text-align: center; transition: transform 0.3s, box-shadow 0.3s; position: relative; border: 1px solid #2a2a2a; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0,0,0,0.3); border-color: #4B9CD3; }
        .card .lbl { font-size: 0.9em; color: #d4d4d4; margin-bottom: 15px; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; }
        .card .val { font-size: 3.2em; font-weight: 200; color: #4B9CD3; }
        .card-desc { font-size: 0.95em; color: #d4d4d4; font-weight: 500; margin-top: 10px; }
        .eff { border: 2px solid #4B9CD3; box-shadow: 0 0 20px rgba(75,156,211,0.2); }
        .eff:hover { box-shadow: 0 0 30px rgba(75,156,211,0.4); }
        .hide { display: none; }
        .show { display: block; }
        .comparison-card { background: #1a1a1a; border-radius: 15px; padding: 30px; margin-bottom: 40px; border: 2px solid #4B9CD3; box-shadow: 0 0 20px rgba(75,156,211,0.2); transition: transform 0.3s, box-shadow 0.3s; }
        .comparison-card:hover { transform: translateY(-8px); box-shadow: 0 0 30px rgba(75,156,211,0.4); }
        .comparison-header { text-align: center; font-size: 0.9em; color: #d4d4d4; margin-bottom: 25px; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; }
        .comparison-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 30px; align-items: center; }
        .comparison-side { text-align: center; }
        .comparison-label { font-size: 0.85em; color: #aaa; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .comparison-value { font-size: 4em; font-weight: 100; color: #4B9CD3; line-height: 1; }
        .comparison-arrow { font-size: 3em; color: #4B9CD3; opacity: 0.7; }
        .comparison-footer { text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #2a2a2a; }
        .comparison-improvement { font-size: 1.8em; font-weight: 300; color: #10b981; }
        .comparison-desc { font-size: 0.9em; color: #d4d4d4; margin-top: 8px; }
        .comparison-context { font-size: 0.8em; color: #888; margin-top: 12px; font-style: italic; }
        
        @media (max-width: 1024px) {
            .dashboard { grid-template-columns: 1fr; }
            .sidebar { position: relative; height: auto; border-right: none; border-bottom: 2px solid #1a1a1a; }
        }
        @media (max-width: 768px) { 
            .grid3 { grid-template-columns: 1fr; }
            .big { font-size: 3.5em; }
            .comparison-grid { grid-template-columns: 1fr; gap: 15px; }
            .comparison-arrow { transform: rotate(90deg); font-size: 2em; }
            .comparison-value { font-size: 3em; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="header">
                <h1>HOAi Base Agent ROI Calculator</h1>
                <p>Configure Your Analysis</p>
            </div>
            
            <h3 class="sidebar-title">Timeframe</h3>
            <div class="timeframe" id="tfBtns">
                <button class="btn" data-y="1">1 Yr</button>
                <button class="btn" data-y="2">2 Yrs</button>
                <button class="btn active" data-y="3">3 Yrs</button>
                <button class="btn" data-y="4">4 Yrs</button>
                <button class="btn" data-y="5">5 Yrs</button>
            </div>
            
            <div class="divider"></div>
            
            <h3 class="sidebar-title">Portfolio</h3>
            
            <div class="input-group">
                <label for="comm">Communities Under Management</label>
                <input type="number" id="comm" value="250" min="1">
                <div class="hide" id="errComm"></div>
            </div>
            
            <div class="input-group">
                <label for="doors">Doors Under Management</label>
                <input type="number" id="doors" value="50000" min="100">
                <div class="hide" id="errDoors"></div>
            </div>
            
            <div class="input-group">
                <label for="head">Headcount</label>
                <input type="number" id="head" value="50" min="1">
                <div class="hide" id="errHead"></div>
            </div>
            
            <div class="input-group">
                <label for="growth">Communities Added Annually</label>
                <input type="number" id="growth" value="25" min="0">
                <div class="hide" id="errGrowth"></div>
            </div>
            
            <div class="input-group">
                <label for="salary">Avg. Expense per Employee</label>
                <input type="number" id="salary" value="75000" min="1">
                <div class="hide" id="errSalary"></div>
            </div>
            
            <div class="divider"></div>
            
            <h3 class="sidebar-title">Efficiency Gain</h3>
            
            <div style="background:#1a1a1a;border-radius:10px;padding:20px;margin-bottom:15px">
                <div class="slider-value">
                    <span id="effPercent">5</span>%
                </div>
                <div style="text-align:center;color:#aaa;margin-bottom:15px;font-size:0.85em">
                    <span id="effHours">2</span> hrs/week per employee
                </div>
                <input type="range" min="0" max="100" value="5" step="5" class="slider" id="efficiency">
                <div class="slider-labels">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>
            
            <div class="benchmark-btns">
                <button class="btn btn-small active" onclick="setEfficiency(5)">Conservative (5%)</button>
                <button class="btn btn-small" onclick="setEfficiency(15)">Moderate (15%)</button>
                <button class="btn btn-small" onclick="setEfficiency(25)">Aggressive (25%)</button>
            </div>
            
            <div class="benchmark-info">
                <span id="benchmarkText">Conservative: Basic task automation. Typical for early adoption.</span>
            </div>
            
            <div class="hide" id="warnEff"></div>
            
            <div class="divider"></div>
            
            <h3 class="sidebar-title">Email Report</h3>
            <div class="input-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="your.email@company.com">
            </div>
            <button class="btn primary" id="sendBtn" style="width:100%">Send Detailed Report</button>
        </aside>
        
        <main class="main-content">
            <div class="badge" id="profile">Loading...</div>
            
            <div class="grid3">
                <div class="card">
                    <div class="lbl">Staff Capacity Added (FTE-Equivalent)</div>
                    <div class="val" id="fteCumulative">0</div>
                    <div class="card-desc" style="margin-top:15px;padding-top:15px;border-top:1px solid #2a2a2a">
                        <span style="font-size:0.85em;color:#aaa">Annual average over <span id="cumYears">3</span> years:</span>
                        <div style="font-size:1.4em;color:#4B9CD3;margin-top:5px"><span id="fteAnnual">0</span> FTE</div>
                    </div>
                </div>
                <div class="card">
                    <div class="lbl">Total Hours Returned</div>
                    <div class="val" id="totalTime">0</div>
                    <div class="card-desc" style="margin-top:15px;padding-top:15px;border-top:1px solid #2a2a2a">
                        <span style="font-size:0.85em;color:#aaa">Annual average over <span id="totalYears">3</span> years:</span>
                        <div style="font-size:1.4em;color:#4B9CD3;margin-top:5px" id="avgTime">0</div>
                    </div>
                </div>
                <div class="card">
                    <div class="lbl">Total Net Cost Savings</div>
                    <div class="val" id="totalSavings">$0</div>
                    <div class="card-desc" style="margin-top:15px;padding-top:15px;border-top:1px solid #2a2a2a">
                        <span style="font-size:0.85em;color:#aaa">Annual average over <span id="savingsYears">3</span> years:</span>
                        <div style="font-size:1.4em;color:#4B9CD3;margin-top:5px" id="annualSavings">$0</div>
                        <div style="font-size:0.75em;color:#888;margin-top:8px;font-style:italic">after HOAi cost</div>
                    </div>
                </div>
            </div>
            
            <div class="card eff" style="margin-bottom: 40px;">
                <div class="lbl">Net Cost Savings ROI</div>
                <div style="font-size:3.8em;font-weight:100;color:#4B9CD3;margin:15px 0" id="roi">0x</div>
                <div class="card-desc">Return on platform investment over <span id="roiYears">3</span> years</div>
                <div style="font-size:0.75em;color:#888;margin-top:8px;font-style:italic">after HOAi cost</div>
            </div>
            
            <div class="comparison-card">
                <div class="comparison-header">Communities Per Team Member</div>
                <div class="comparison-grid">
                    <div class="comparison-side">
                        <div class="comparison-label">Year 1</div>
                        <div class="comparison-value" id="cmrBefore">0</div>
                        <div class="comparison-desc">Baseline</div>
                    </div>
                    <div class="comparison-arrow">â†’</div>
                    <div class="comparison-side">
                        <div class="comparison-label">Year <span id="cmrYearLabel">3</span></div>
                        <div class="comparison-value" id="cmrAfter">0</div>
                        <div class="comparison-desc">With scaling</div>
                    </div>
                </div>
                <div class="comparison-footer">
                    <div class="comparison-improvement" id="cmrImprovement">+0%</div>
                    <div class="comparison-desc">Efficiency gain through automation</div>
                    <div class="comparison-context">Gained capacity absorbs growth without new hires</div>
                </div>
            </div>
            
            <section class="hero">
                <h2 style="font-size:1.4em;font-weight:600;margin-bottom:20px;text-transform:uppercase;letter-spacing:1px">
                    Total Net Savings Over <span id="per">3</span> Year<span id="pl">s</span>
                </h2>
                <div class="big" id="totVal">$0</div>
                <div style="opacity:0.9;font-size:1.1em">Traditional hiring costs vs. HOAi platform investment</div>
            </section>
        </main>
    </div>
    
    <script>
        var APP = { tf: 3, eff: 5 };
        var CFG = { 
            sg: 0.046,   // Annual salary growth rate (4.6%)
            br: 0.35,    // Benefits rate (35% of salary)
            rc: 4700,    // Recruitment cost per hire (matches Voice module)
            tr: 0.30,    // Turnover rate (30% annually - matches Voice module)
            th: 30,      // Training hours (matches Voice module)
            oh: 40,      // Onboarding hours (matches Voice module)
            sr: 35.83,   // Supervisor rate per hour (matches Voice module)
            ow: 8,       // Onboarding weeks
            owp: 0.5,    // Onboarding productivity factor (50% during training)
            ww: 50,      // Working weeks per year
            wh: 40,      // Working hours per week
            effImprovement: 0.025,  // 2.5% efficiency improvement per year
            tranches: [
                { max: 5000, rate: 0.54 },
                { max: 10000, rate: 0.39 },
                { max: 25000, rate: 0.29 },
                { max: 60000, rate: 0.24 },
                { max: 999999, rate: 0.19 }
            ]
        };
        
        function fmt(n) { return '$' + Math.round(n).toLocaleString(); }
        
        function setTime(t) {
            APP.tf = t;
            var btns = document.querySelectorAll('#tfBtns button');
            for (var i = 0; i < btns.length; i++) {
                btns[i].classList.toggle('active', parseInt(btns[i].getAttribute('data-y')) === t);
            }
            calc();
        }
        
        function setEfficiency(pct) {
            document.getElementById('efficiency').value = pct;
            var btns = document.querySelectorAll('.benchmark-btns .btn');
            for (var i = 0; i < btns.length; i++) {
                btns[i].classList.remove('active');
            }
            event.target.classList.add('active');
            updEff();
        }
        
        function updEff() {
            var e = Number(document.getElementById('efficiency').value);
            APP.eff = e;
            document.getElementById('effPercent').textContent = e;
            document.getElementById('effHours').textContent = ((e / 100) * CFG.wh).toFixed(1);
            
            var benchmarkText = '';
            var warnDiv = document.getElementById('warnEff');
            
            if (e < 5) {
                benchmarkText = 'Very conservative: Minimal automation impact.';
            } else if (e >= 5 && e < 15) {
                benchmarkText = 'Conservative: Basic task automation. Typical for early adoption.';
            } else if (e >= 15 && e < 25) {
                benchmarkText = 'Moderate: Standard workflow automation. Industry average is 15-20%.';
            } else if (e >= 25 && e < 40) {
                benchmarkText = 'Aggressive: Comprehensive automation. Best-in-class is 30-40%.';
            } else if (e >= 40 && e < 60) {
                benchmarkText = 'Very aggressive: Full digital transformation level.';
                warnDiv.className = 'warning-msg show';
                warnDiv.textContent = 'Efficiency above 40% is uncommon. Verify this is achievable.';
                document.getElementById('efficiency').classList.add('warning');
            } else {
                benchmarkText = 'Extreme: Verify this is realistic for your operation.';
                warnDiv.className = 'warning-msg show';
                warnDiv.textContent = 'Efficiency above 60% is very rare. Use conservative estimate.';
                document.getElementById('efficiency').classList.add('warning');
            }
            
            if (e < 40) {
                warnDiv.className = 'hide';
                document.getElementById('efficiency').classList.remove('warning');
            }
            
            document.getElementById('benchmarkText').textContent = benchmarkText;
            calc();
        }
        
        function validateInputs() {
            var isValid = true;
            
            var c = Number(document.getElementById('comm').value);
            var d = Number(document.getElementById('doors').value);
            var h = Number(document.getElementById('head').value);
            var g = Number(document.getElementById('growth').value);
            var s = Number(document.getElementById('salary').value);
            
            // Communities validation
            var errComm = document.getElementById('errComm');
            var commInput = document.getElementById('comm');
            if (c < 1) {
                errComm.className = 'error-msg show';
                errComm.textContent = 'Communities must be at least 1';
                commInput.classList.add('error');
                isValid = false;
            } else {
                errComm.className = 'hide';
                commInput.classList.remove('error');
            }
            
            // Doors validation
            var errDoors = document.getElementById('errDoors');
            var doorsInput = document.getElementById('doors');
            if (d < c) {
                errDoors.className = 'error-msg show';
                errDoors.textContent = 'Doors must be greater than or equal to communities';
                doorsInput.classList.add('error');
                isValid = false;
            } else if (d < 100) {
                errDoors.className = 'error-msg show';
                errDoors.textContent = 'Doors must be at least 100';
                doorsInput.classList.add('error');
                isValid = false;
            } else {
                errDoors.className = 'hide';
                doorsInput.classList.remove('error');
            }
            
            // Headcount validation
            var errHead = document.getElementById('errHead');
            var headInput = document.getElementById('head');
            if (h < 1) {
                errHead.className = 'error-msg show';
                errHead.textContent = 'Headcount must be at least 1';
                headInput.classList.add('error');
                isValid = false;
            } else {
                errHead.className = 'hide';
                headInput.classList.remove('error');
            }
            
            // Growth validation with warning
            var errGrowth = document.getElementById('errGrowth');
            var growthInput = document.getElementById('growth');
            if (g < 0) {
                errGrowth.className = 'error-msg show';
                errGrowth.textContent = 'Growth cannot be negative';
                growthInput.classList.add('error');
                isValid = false;
            } else if (g > c * 0.5) {
                errGrowth.className = 'warning-msg show';
                errGrowth.textContent = 'Growth rate above 50% annually is very aggressive. Verify assumptions.';
                growthInput.classList.add('warning');
            } else {
                errGrowth.className = 'hide';
                growthInput.classList.remove('error', 'warning');
            }
            
            // Salary validation
            var errSalary = document.getElementById('errSalary');
            var salaryInput = document.getElementById('salary');
            if (s < 10000) {
                errSalary.className = 'error-msg show';
                errSalary.textContent = 'Salary seems unrealistically low';
                salaryInput.classList.add('error');
                isValid = false;
            } else if (s > 500000) {
                errSalary.className = 'warning-msg show';
                errSalary.textContent = 'Salary is very high. Verify this is accurate.';
                salaryInput.classList.add('warning');
            } else {
                errSalary.className = 'hide';
                salaryInput.classList.remove('error', 'warning');
            }
            
            return isValid;
        }
        
        function getPricing(doors) {
            var monthlyCost = 0;
            var remaining = doors;
            var prevMax = 0;
            
            for (var i = 0; i < CFG.tranches.length; i++) {
                var tranche = CFG.tranches[i];
                var trancheSize = tranche.max - prevMax;
                
                if (remaining > 0) {
                    var doorsInTranche = Math.min(remaining, trancheSize);
                    monthlyCost += doorsInTranche * tranche.rate;
                    remaining -= doorsInTranche;
                    prevMax = tranche.max;
                } else {
                    break;
                }
            }
            
            return {
                m: monthlyCost,
                y: monthlyCost * 12,
                rate: doors > 0 ? monthlyCost / doors : 0
            };
        }
        
        function calc() {
            if (!validateInputs()) {
                return;
            }
            
            var c = Number(document.getElementById('comm').value) || 250;
            var d = Number(document.getElementById('doors').value) || 50000;
            var h = Number(document.getElementById('head').value) || 50;
            var g = Number(document.getElementById('growth').value) || 25;
            var s = Number(document.getElementById('salary').value) || 75000;
            
            // Calculate year-by-year efficiency with improvement (2.5% per year)
            var totalHours = 0;
            var totalFTE = 0;
            
            for (var y = 0; y < APP.tf; y++) {
                var yearEfficiency = APP.eff * (1 + (CFG.effImprovement * y));
                var yearEffHrs = (yearEfficiency / 100) * CFG.wh;
                var yearHours = yearEffHrs * CFG.ww * h;
                var yearFTE = yearHours / (CFG.wh * CFG.ww);
                
                totalHours += yearHours;
                totalFTE += yearFTE;
            }
            
            // Average annual values
            var avgAnnualHours = totalHours / APP.tf;
            var avgAnnualFTE = totalFTE / APP.tf;
            
            // Portfolio growth calculation
            var finalComm = c + (g * APP.tf);
            var doorsPerComm = d / c;
            var finalDoors = d + Math.round(doorsPerComm * g * APP.tf);
            
            // Year-by-year platform cost calculation
            var totalPlatformCost = 0;
            var avgRateForDisplay = 0;
            for (var y = 0; y < APP.tf; y++) {
                var yearDoors = d + Math.round(doorsPerComm * g * y);
                var yearPricing = getPricing(yearDoors);
                totalPlatformCost += yearPricing.y;
                avgRateForDisplay += yearPricing.rate;
            }
            avgRateForDisplay = avgRateForDisplay / APP.tf;
            
            // UPDATED: Traditional hiring cost calculation (matches Voice module)
            // Initial hiring costs
            var initialHiringCost = avgAnnualFTE * CFG.rc;  // $4,700 per hire
            
            // Calculate year-by-year salary and benefits
            var totalSalaryAndBenefits = 0;
            for (var y = 0; y < APP.tf; y++) {
                var yearSalary = s * Math.pow(1 + CFG.sg, y);
                var yearFullyCost = yearSalary * (1 + CFG.br);
                totalSalaryAndBenefits += avgAnnualFTE * yearFullyCost;
            }
            
            // Initial onboarding cost (matches Voice module)
            var year1Salary = s;
            var year1Wage = year1Salary / 52 / 40;  // Convert to hourly
            var initialTrainingCost = avgAnnualFTE * ((CFG.th * CFG.sr) + (CFG.oh * year1Wage));
            
            // ADDED: Replacement hiring costs (30% turnover annually)
            var replacementHiringCosts = 0;
            var replacementTrainingCosts = 0;
            
            for (var y = 0; y < APP.tf; y++) {
                var yearWage = (s * Math.pow(1 + CFG.sg, y)) / 52 / 40;
                var turnovers = avgAnnualFTE * CFG.tr;  // 30% of FTE turn over each year
                
                // Recruitment costs for replacements
                replacementHiringCosts += turnovers * CFG.rc;
                
                // Training costs for replacements (matches Voice formula)
                replacementTrainingCosts += turnovers * ((CFG.th * CFG.sr * Math.pow(1 + CFG.sg, y)) + (CFG.oh * yearWage));
            }
            
            // Total hiring costs (initial + replacements over time)
            var totalHiringCost = initialHiringCost + replacementHiringCosts;
            var totalTrainingCost = initialTrainingCost + replacementTrainingCosts;
            
            // Onboarding lost productivity (first 8 weeks at 50% efficiency)
            var year1FullyCost = year1Salary * (1 + CFG.br);
            var onboardCost = avgAnnualFTE * (year1FullyCost / 52 * CFG.ow * CFG.owp);
            
            var traditionalCost = totalHiringCost + totalSalaryAndBenefits + totalTrainingCost + onboardCost;
            
            // Calculate savings and ROI
            var savings = traditionalCost - totalPlatformCost;
            var savingsPct = traditionalCost > 0 ? (savings / traditionalCost) * 100 : 0;
            var roi = totalPlatformCost > 0 ? traditionalCost / totalPlatformCost : 0;
            
            // Update display
            var dpc = d / c;
            document.getElementById('profile').textContent = 'Portfolio: ' + Math.round(dpc) + ' doors/community | Pricing: $' + avgRateForDisplay.toFixed(2) + '/door/month | Growth: ' + c + ' to ' + finalComm + ' communities';
            
            // FTE Capacity - show cumulative as main, annual average below
            document.getElementById('fteCumulative').textContent = totalFTE.toFixed(1);
            document.getElementById('fteAnnual').textContent = avgAnnualFTE.toFixed(1);
            document.getElementById('cumYears').textContent = APP.tf;
            
            // Hours Returned - show total as main, annual average below
            document.getElementById('totalTime').textContent = Math.round(totalHours).toLocaleString();
            document.getElementById('avgTime').textContent = Math.round(avgAnnualHours).toLocaleString();
            document.getElementById('totalYears').textContent = APP.tf;
            
            // Cost Savings - show total as main, annual average below
            var annualAvgSavings = savings / APP.tf;
            document.getElementById('totalSavings').textContent = fmt(savings);
            document.getElementById('annualSavings').textContent = fmt(Math.round(annualAvgSavings));
            document.getElementById('savingsYears').textContent = APP.tf;
            
            // ROI and timeframe label
            document.getElementById('roi').textContent = roi.toFixed(1) + 'x';
            document.getElementById('roiYears').textContent = APP.tf;
            
            // Communities per team member - Before and After
            var cmrYear1 = c / h;
            var cmrFinal = finalComm / h;
            var cmrImprovement = ((cmrFinal - cmrYear1) / cmrYear1) * 100;
            
            document.getElementById('cmrBefore').textContent = cmrYear1.toFixed(1);
            document.getElementById('cmrAfter').textContent = cmrFinal.toFixed(1);
            document.getElementById('cmrYearLabel').textContent = APP.tf;
            document.getElementById('cmrImprovement').textContent = '+' + Math.round(cmrImprovement) + '%';
            
            document.getElementById('totVal').textContent = fmt(savings);
            document.getElementById('per').textContent = APP.tf;
            document.getElementById('pl').textContent = APP.tf > 1 ? 's' : '';
        }
        
        function sendReport() {
            var em = document.getElementById('email').value;
            if (!em || em.indexOf('@') === -1) { 
                alert('Please enter a valid email address.'); 
                return; 
            }
            
            var txt = 'HOAi WORKFLOW AGENTS - CAPACITY ANALYSIS%0D%0A%0D%0A';
            txt += 'EXECUTIVE SUMMARY%0D%0A';
            txt += 'Period: ' + APP.tf + ' Years%0D%0A';
            txt += 'FTE Capacity Gained: ' + document.getElementById('fteAnnual').textContent + ' annually%0D%0A';
            txt += 'Cumulative Capacity: ' + document.getElementById('fteCumulative').textContent + '%0D%0A';
            txt += 'Annual Cost Savings: ' + document.getElementById('annualSavings').textContent + '%0D%0A';
            txt += 'Total Savings: ' + document.getElementById('totalSavings').textContent + '%0D%0A';
            txt += 'Efficiency Gain: ' + APP.eff + '%% (improving ' + (CFG.effImprovement * 100) + '%% annually)%0D%0A';
            txt += 'ROI: ' + document.getElementById('roi').textContent + '%0D%0A%0D%0A';
            txt += 'Next: Schedule demo at sales@hoai.com';
            
            window.location.href = 'mailto:' + em + '?subject=HOAi Workflow Capacity Analysis&body=' + txt;
            alert('Email prepared! Check your email client.');
        }
        
        function sendReportMain() {
            sendReport();
        }
        
        var inp = ['comm', 'doors', 'head', 'growth', 'salary'];
        for (var i = 0; i < inp.length; i++) {
            document.getElementById(inp[i]).addEventListener('input', calc);
        }
        document.getElementById('efficiency').addEventListener('input', updEff);
        
        document.querySelectorAll('#tfBtns button').forEach(function(btn) {
            btn.addEventListener('click', function() {
                setTime(parseInt(this.getAttribute('data-y')));
            });
        });
        
        document.getElementById('sendBtn').addEventListener('click', sendReport);
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', calc);
        } else {
            calc();
        }
    </script>
</body>
</html>
